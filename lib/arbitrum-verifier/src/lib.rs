use core::fmt::Debug;

use arbitrum_light_client_types::{ClientStateV1, Header};
use arbitrum_types::{
    L1_NEXT_NODE_NUM_SLOT, L1_NEXT_NODE_NUM_SLOT_OFFSET_BYTES, L1_NODES_CONFIRM_DATA_OFFSET,
    L1_NODES_SLOT,
};
use evm_storage_verifier::{verify_account_storage_root, verify_storage_proof};
use sha3::{Digest, Keccak256};
use unionlabs::{
    ethereum::slot::{MappingKey, Slot},
    primitives::{H256, U256},
    ByteArrayExt,
};

#[derive(thiserror::Error, Debug, PartialEq, Clone)]
pub enum Error {
    #[error("invalid l1 contract address proof")]
    InvalidL1ContractAddressProof(#[source] evm_storage_verifier::error::Error),
    #[error("invalid _latestConfirmed proof")]
    InvalidNextNodeNumSlotProof(#[source] evm_storage_verifier::error::Error),
    #[error("invalid _nodes[_latestConfirmed].confirmData proof")]
    InvalidNodeConfirmDataProof(#[source] evm_storage_verifier::error::Error),
    #[error("invalid L2 proof")]
    InvalidL2Proof(#[source] evm_storage_verifier::error::Error),
}

pub fn verify_header_v1(
    client_state: &ClientStateV1,
    header: &Header,
    l1_state_root: H256,
) -> Result<(), Error> {
    // Verify that the L1 account root is part of the L1 root
    verify_account_storage_root(
        l1_state_root,
        &client_state.l1_contract_address,
        &header.l1_account_proof.proof,
        &header.l1_account_proof.storage_root,
    )
    .map_err(Error::InvalidL1ContractAddressProof)?;

    // Verify that the L1 `ClientState.l1_next_node_num_slot` is part of the L1 Rollup account root
    verify_storage_proof(
        header.l1_account_proof.storage_root,
        L1_NEXT_NODE_NUM_SLOT.into(),
        &rlp::encode(&header.l1_next_node_num_slot_proof.value),
        &header.l1_next_node_num_slot_proof.proof,
    )
    .map_err(Error::InvalidNextNodeNumSlotProof)?;

    // the .value is verified by the proof above
    let node_num = u64::from_be_bytes(
        header
            .l1_next_node_num_slot_proof
            .value
            .to_be_bytes()
            .array_slice::<{ L1_NEXT_NODE_NUM_SLOT_OFFSET_BYTES as usize }, 8>(),
    );

    // Verify that the L1 `_nodes[ClientState.l1_nodes_slot].confirmData` is part of the L1 Rollup account root
    let node_confirm_data_slot = nodes_confirm_data_mapping_key(node_num);

    let expected_confirm_data = Keccak256::new()
        .chain_update(header.l2_header.hash())
        .chain_update(header.l2_header.extra_data)
        .finalize();

    // Verify that the node's `confirmData` is correct
    verify_storage_proof(
        header.l1_account_proof.storage_root,
        node_confirm_data_slot,
        &rlp::encode(&U256::from_be_bytes(expected_confirm_data.into())),
        &header.l1_nodes_slot_proof.proof,
    )
    .map_err(Error::InvalidNodeConfirmDataProof)?;

    // Verify that the ibc account root is part of the L2 root
    verify_account_storage_root(
        header.l2_header.state_root,
        &client_state.ibc_contract_address,
        &header.l2_ibc_account_proof.proof,
        &header.l2_ibc_account_proof.storage_root,
    )
    .map_err(Error::InvalidL2Proof)?;

    Ok(())
}

/// Storage slot of a `mapping(uint64 => Node)` mapping, where the mapping is at slot `slot` and the `uint64` is the `nodeNum`, accessing the storage at the offset of confirm_data_offset.
pub fn nodes_confirm_data_mapping_key(node_num: u64) -> U256 {
    Slot::Mapping(
        &Slot::Offset(L1_NODES_SLOT.into()),
        MappingKey::Uint64(node_num),
    )
    .slot()
        + L1_NODES_CONFIRM_DATA_OFFSET.into()
}

#[cfg(test)]
mod tests {
    use arbitrum_light_client_types::ClientState;
    use hex_literal::hex;

    use super::*;

    #[test]
    fn verify_header_v1_works() {
        let header = serde_json::from_str::<Header>(
            r#"{"l1_height":"8051156","l2_header":{"miner":"0xa4b000000000000000000073657175656e636572","nonce":"0x0000000000000034","number":"175774","gas_used":75978,"mix_hash":"0x000000000000000200000000007ad91000000000000000200000000000000000","gas_limit":1125899906842624,"timestamp":1743793592,"difficulty":"1","extra_data":"0x5fa375a6a86d04dc75595355d967f63e4518bd2766f2454237ee4dbbb11cffab","logs_bloom":"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","state_root":"0xa7971e3a4adf60e683572de22667ea46fb2a597261b6a4749c5b2297a04b90d4","parent_hash":"0x9868881ec896dcf537caeb2deb371ddf4975a6ecb473c8791b22054d8bc6e1b2","sha3_uncles":"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347","receipts_root":"0xc026d2807d75e2c59d55e8131b521a0eb10e22d05d6e173c71603b4f210624ea","base_fee_per_gas":"10000000","transactions_root":"0x8e151707b4ad89fbb97a73ab226a435ad91d82eaf4000ad800ed4d101987437d"},"l1_account_proof":{"proof":["0xf90211a0d541d8cf5bce2dfe8dcd7c4b168899ab788464fe000da998285ac47d87bc6e07a0f75f533b21f6fcbc36240dd82bce7a38b92c61a35a86e71896cb83f245014f3ca0cea8d4216cca009b4508a8d1c00ea7c6d3dec3a0cb53ae998fa21680d940c443a04263197c4c12af8b35971902d23ab27da06fb5ecee640ee98b39e0361a3581f5a030a90752aa14e3b3e7d34984acb6087a9ab1d2bfd60e6572a0444892b78202d6a07793474e09417f4678ee148cfb9603cd2bd83d7a7f6bd5c702f2ebd8afbfc629a0de1ef3394a155d0a9e60d0049af46fb9939a576c55dd36bf515dadfb49c0c3eca00d81b393f3f62793d4282e253eaed48f6d1c2cca1e8e619b6ce65bb8652daacfa0dcafa9ba031aee839c29dd7c9b9f994e35eda26e280515575d8dcdd04eee6712a0744ab587527e0d5dd6042db4b1b0d90339aaaa5f0d3191386b42f0e06d73087ca08ee12c3112ce380c7e8d20998851be95a138159f81f7ab9f76c19fd1f4e98689a0683b53fdc725d009c4b92e91e0bcd284b1a1dfa9e1ca62176a14e6123bdf7f00a013bc42c2897538fed75dd2942e7deb701bdaed539cdc97e25123d0f783817e19a05e56c73c734ed7b058369d21e5ed8550a3c60dfa1d240db92a4dfe600a5112cca0c5feb16ae1a8555477fc222eaf0d27bae15bff118c5339970aaf7339c6120a64a0c6fc9df654a4da9bea2fdcbfcbc232c15e6543787c44f0681dcd912c07ba594080","0xf90211a0bb52616c7947f25f8ca7b7664cc2b5ad081627e1ab274cf08223dd3c5e214554a0c5bad9c5a873d607580187a4429c3ab3ac25d61973bbf194786e95f750a9c15da08d910aba9e21983cdf61280a14d264d8a85258f089b59c51e068c45f1e7c84e7a0993a352d406aea64d67e7eb17fb22769d461f4d69b56dda475863802e155c812a0fccde608229672a11c4ef792a6642a370727ff633fbcbabd7426b7425a44217fa0a1e8e29d3a9f0d348d412fdb1b07f72ba345f1e31001e77eacb2a0edf47a349aa0eedb58f7264ee8fca52701edfdcaa938f2f3166646bf624532cbce5f8193b5c7a0972a31ee217799376011990c9a2209fab9724df0092d8ec167af7232b1d7a10aa035a6d7b21622f7b1376ac92e906a7d1a17974180e9c105dc47d5a5b37665c767a0e3f9d6c8622d74d129d2a86d5a0799c66f0e741d4c6c0091e5befc519bffe602a0b98c665ba6b5cf939fa3a940b96b1ff3b096078800fe80b65b552def5ffb035da010ad76e4b7f0fa91cff754bb5a96e331ad0ff7b41d2f2ace13d2097cd7f5d0cba03acbcfe65ba3dd8e60e4b8727aee6ec2543a3928bc94fc53b4fda75e02d24f92a01037a58a6301b90dc404b95f6ba62dd7b285c7a5ebfcd4abfaa93d24bb93df19a08e98303e28675106d4a6a2e8e05a83a22a49c80796f1739e8059c039e67285e8a017dec260d2616b6ce372c4ff4ac35ef295d06677eef269f05e0879aba15987d780","0xf90211a05c160f4572eb47c59662e27bfb51527b69514ac835fc279cf388f23e331a0ca1a0621254877cbd01c72f904e9b659f2be5c00f2021bebbe6dac835d34555f1dba0a0a0d084da3b99b1777b84935a3b1ed3c88fed5faf9a84bffbd3b8e301c64a69d0a0d67e5090bf4eed915b85a7e77e99521d5a17e2254b60a93eeefae49cd4d62b1aa0fe3f8a915ab993213bc172328c8434843ea48e6f733757803e183b7679e65a14a05c13d2241e3a74cf22fe8f5e78df370834eb338aa7eaa1c25a7eab5edc4712c2a0427eda7a761ee4a53eb63d1a0476bb31789a264ff492450c8dcdd9dc47aac198a07c13517d1801bbcb3ce36def6950c918afc02954e7f3076078fa12af0f7ae6b7a04a4a547e004bb9bc2dc33a0de80efefe2e8c255f170f3ce3f2836ab4522d1be3a00c82badd591727ea1f63f73bd105fc2b798cfd592e7ef9f1ccbb1b0a059ced49a09177a8f144cdf3dd065b94611584adb832c516dc61bbbe34b79a1fa7a2731c9fa09328dbde85ec109c1065bb65b67c887394fd8348a36d91b3f74e9d27f4744daca0a5d6a9a5a4cc6829065af32651ee3bb24f14d0577ef3a34b46bfad062b035f87a0269bfa5f8c8e65106ab4127c5c4f6350b6eefd405ab27b63518bafcd3cf3b60aa0af5ad7ecdef904bc6a52a1df2911dc10edff6e8ef3392a3f0da9edc75943b326a0f24ce80a8e3629af34e7a489f4cc05c485f67ee953e66b90ee904371ef9d94ee80","0xf90211a05054fbc633d5aef22a04d08e891642495783be46d4c11cbb132e46088e2f2cdaa0aa4cab63a5b40b005cf77d5f0d5cfb75a60c82431a346e42c311ad7d7d92d97fa05818d38f8e218b5acd5467950d8c394bcfe9fabdc23ed849013d7b6a138152d4a07452570896039998e7231d58a5c4cac33bcb218fd221be90808c0b301c1a626ca08d786be98e8086ec99ae6a3ea7333c55c0209d7ba0816a0302e3d40bddb17668a0a379f2adb70ccdf4b78565a38ffa02e434cbd4701bc089a7bef9453159f080c8a082291cfdb4a8fb9e3de71097b78cafdf2625009da9856e88a610914010573058a0b8c21e0e8fc5c7a7839656a3dfacba31ec6227f22375e06c94808dd717187d94a0a0700a6a72cdc3c7b11c65063fd809b659c5487f750a46696cb95ee45c9da226a092f33b1f6daa568524704419faf0cc476096a37ac4b3e0b278b0f6175988c31fa07aff7e1255ba555664c431c7e69f34e9939ff2afb8830e8a033dce8394669ab7a0f250cbac96592a3fd460e3147335707e040898cbe2a176d3603015f676497b6aa01ad0a24b4e280bb361a95bfda3d5514a7d8317527b5d85f0553591e23f46a953a0772e5cb725d0fb5d35bd358d43b8efde96833af31261349a43a4bbd09a24562ea091d75c77286e5b863c8232a0faadfcbb14c9753fba65a56c2da0e348e73935c2a0959aed9e30ddf73859fe1317d4f9ab4f6fb11776a971693974b3f1c3f62b167c80","0xf90211a0978cc80d285df07c64f6600be4562ac03ec28db895740506bad69f69ca673e07a063b0d1328f834dc6fe28026d5986669c0289767eea5948609d0eae7e311c938ba007f03e3b67c6a3a64b84107c0c231c07cac255ae8079018dae8013fa86e5f3bca0184d558df5e9cc8268942cce5def841feb137f138b537ea51345b9c9e5437609a01a7263a224e8a01e77b8d6662a4ca63503b94d3098f85f9c4ce6f34c3f861a6aa0671c2eb9a405d161a16bf3e4c55f2efb0493ade9cf4bf8b740d0c0fa4b263396a000d9c46b54c8f3a5c59774599b8299047905e0d7255e2e783a006bdd05709b7ea040cdeeb856346896337c5fdbec24f40e78861ce0a2844f2c5412345b09924a5da0b74a9be81b6070a57a58cc1119066420d80094624f16716940081129ac846959a09fc6d8ac16df42ccd50ca5d34ff9a84d559e762a32abd891912a46580e298be1a0d96c7b02f783614bf755d4db1054eeb00b1a9a64de4c7f1e0d7e66ac7ee05b52a00ee1f38d34053f99ad5e4df7fd29e3cf8dd9dbd3d2bee027672d7e0622cab466a0157013cdc8366e2c42e39d2e4c17938faf983c0e1ef5377939135c43435ac874a02b937fd3ad8dffe190782d237bf859cb0584b61fa88aa49563210b18132267f2a0de232f38937169c9789c7fe8bc48e208f8ab728594baf528263707138ce8e718a011e97b7a434e0edae6a8a77d3472f36025c1798ca5afdc0c88e586a0480bda7a80","0xf90211a04711c5b2e10040f3844fa332b369fc515ec8321ec8c706fbdcfdd8a1a7903276a0de0e82cbab661d44f4306eb7870b3bb02da902921d6298b9162e5fab8a1729ada08952e0684f9526724d2eb2a10da9b20856ea919345f68791c70ed7a0c201f1d8a0c722ed649bef6ae586c67c5927f23fae1dd79694cd1999376b3935fc86188a63a0ee5ed59ea90658958c94adeed7922e5c640378151a18ba63ee7472565616b047a0157feb8fd0382e5709afb2d3cc09ec1f530b73224234e94f9c088443c704b675a0be321a42abb683ebc95df94c757800a25d3ea22a13ac18b9350e2a990b48be55a09af04797972640735d9cd95c73b5f647d518a286ceb6acd734747a079f37a66ba0bd5fdebfe176701ff0616114f6250eb682adb4ed8fbd8f1f7b0c643daa231401a01643eb0cfbc20f03556341f963412938f2f8fbdfaabe15d37eac256d317b9b18a0f26efb33476a49730b42cb9dd717556379710189d77d6174f60728c7c8d58ad8a05582e0c27a56ff1c98aadc2a33ac41e9ecd4953e87ebd16861ae0e3817cfb990a0f350a004b79f81d237ca9eb7aa794f36193d78f73720cb381a69c991c0445138a019c0e8c507b7acd7e287f3a8e5c2532836ce05a60040881b9c38de08589f8070a01a11e897fe1afa6308c7e652691edc0ea4d437d70aa3bf15fc2da265b81fbf59a014a243fec58fd1b58f3a3aedf15d347694a0f1d6456e7c0748b3f2badf801e0680","0xf8d180a042925ca70459c9565b5aaeb43d72ca0f9604e2a2bdb35fedaa4a7bafe6d4773b80a03856a7557eae2e5dc64b0e0df937da9ae2091dbf9e7b3088a4de55da3e5b1d838080a0b094f9ba65db0d58db682564e1ae3f25ff484d008d47e971972db6e7344e300780a0f25c1383a6d7041a1846c9f3c844897c4bcf20cf34d55805d1c056609e3a0a64a06d4331d28c8ce60111ec265e1511273f40ece94739dad37bc66f39c385da183280808080a0fd4f390f5c1441111c971caef38057496edf82d16da9cddeeb293e63e46015c58080","0xf86e9d3d290908223223d510abe09bba785117a71bce51796ea9a88be577643eb84ef84c0188016345785d8a0000a0e9ca59b3635edba070c485eb5d402e3d4b58e9ca6c84f27b217917c458e36de5a0f8cb3ff11d3c43193ca30b0cc6c21d1143f072e4b45bd4c2af1069c9fa69ca10"],"storage_root":"0xe9ca59b3635edba070c485eb5d402e3d4b58e9ca6c84f27b217917c458e36de5"},"l1_nodes_slot_proof":{"key":"88600565507719433665650673477680347858252592813736026404486188513770717830104","proof":["0xf90211a0378976b79a40d72a7aa1c422c02e67df614714be62363422a001007363aa34c1a0505128b8a90c1ae06d7b4e79d181bb1586be683d56f0eb5eb2f38eafe166afe1a0b784abc4936bcb27d8355b8311ae7644ba506a59c2f7061b7d52fc4c434c0517a075b64f474b83dd0f55e5e16fff6512f7f85e5ec1a1e5cbe9148581ba4ec598eda08d6b503164a45e76138d40a7d7e56ff91549ad38530f3b6ac7d4f2ee943957eca078821092621d2e3f7f621e8d15c9da570f234fe0e644ff296a08c1884b312f9ea09cbe765dfc6f7e184d967b0e03ba578282b528d6ffdef601164940234ddea18fa0cef0ff64344b715000c483f788016438774e6cc8484cdb18cc361e7b245dc123a0fdfa1e446df19af67f691121361499597993c65e69370661d03ef922a3f78910a0cc5b4e0cdcd2429154aa6a8c08d01c93cad7413044f21df107322be09f365abfa0af8ab900a5b8352836adfd6d0c7f30cf9b018ea2ba730312beb4023bf73666c3a040d0f37dff843b1660c606e8f03b1201a25ed7b0fbd3098c9a1eea576fc21ae4a087922516d5a213262c42af3c84caf92f9acd9d65e442e318c4e8fb2e1566cc86a0f89b382075a2be2fa560e9b63ea24c8bfb3ffa5fa94b4ffaec55be27efca1ca0a083315309a8356f86aee6a56e8b92d728d099abe32fe091d9b7d0dbd2b5d2bc1aa017f94590b4244ded96f036bdbb8e0922301bf3b3bfb561d4bff8cd5410e824cb80","0xf90211a0863679ec0454588a0733adad6a0af8ae177a3ba56f0d0d2cfcb294b1a2efa62da096d1ccb485e8a6538cbff3f8e989c8b57daa43ba54d4717383d24b4bf45552d4a0f7a35bdf2753ea50dddfb2ee811873d29b8e83613d2df2cd4aa5fc7f501b35e0a02a98308b63afcbee1a779a2aae53cb9f5dab46f5b24baafffae54f975418350aa07b87d8de54b8b0b6945cffd1c1be53c7d530fdc2f499d6d0515b8db9a5315bc0a0cc7dabb34be65524d10e25bb09b3c47a9f457bc7678ca51c767608b21ca6dbaaa0beca59427f4bc6acb8204bfa607cf74c85093c4bf591623e3fef98ca134864f1a0da11873347f8991a797695517fb47fe45de8423bb35f4398f714719ba373faf9a049307378d751d01eac8cac81bb2c315fa7027bb22cc545c7afca11fa4f1de42ea0898a5881ed64c0bd79dc31dccd65f58f5515ef87d675d7753f5674079c29167ea04e6e21f6ea49fa5bfb5107a748eaa30d41ef4034c96584fa51c6dc53b763a2d9a0d4c28dc349315edf18e4dfe22c7564f44c9707bf7914122943f98ee6cfa6bce9a0763161a3fff1845f06160938b69831f55c50582c66d1d4a4be79272427f439aca03762f50260303bce37c27cb02908165dc8c97ebd9861ba30458093604b00ec63a0691cb19e6e8b2d57bcf2844c463e2dc5306dbc05fc75b5e394e236e161fa8272a03faf00222a1eb436ee5bcbc030fabaf916b93b5bf9b65612c61d1b31b38360a780","0xf90211a07fdccd6544571509ec850b5017aac4687872dc300b48f308661c7d233da34f85a0634f666f9675771b644fa5fcf693534db1d0911ff3254f850a94d51df55531d2a079db1933674b6362429f106f930faf675254cc661b281014c5703c8c2427e6c0a0af0e7ee62adcabe34c5c8e849ba17d2e504e59146820ebae27e22a3d00af58d2a0b801240c6eb6686017d74c49cd6b518a8f8c5cb8fb77df3eaa01368c5dd7e224a04e05ebdad2f01645b87b5ba4c2f5299b05da671bed6dae861540ca7c2a4562a3a05874f89d9447ad3fd665d18301afb1a5374846945c09515a2eab75cfe8b693cfa0cb39b5fa0f3dad2116c08e09a741b3c317d65a76bf23d407c4a5fc66ddef629fa0a7c95c90b36fee018b7e80c0c0725731dcc952cecf8cbcebb5a3544b32e7ce90a04927b34d091fb09c284e6f94c506c751f2313ae5671f9aceb2aab6b956733616a00f30c9649ad30b63e9b2964ee0f3259fa1f3a709ef73a2066b396007eccd5258a055d8ab0a21b76e871582effc5b9b127b858624829db034b438c43595c1afdd3ba0545927af0fda4d42baca4bed7efa98d8a585c61b6bee6b782a601e6cb492e16aa0eb534d1ad27f3d5721649050938f7072ea0c2f4769e83c63d1dbc3a397e7f3b8a07b94ca084c2b4131de772920728de73329c79183d1fe3c86c1a47c5cdfa01575a0d7cdd913deec4e8ca2e7cbc8f32cb2e48d392ec5fe62eb142d1896a5e40e205e80","0xf8b18080a03df8d46c2e4c68ccffae7848d732de11d353d5d993da7d965f1a82379f5153818080a09db0851c8bbde9f119946aeeeab33edc828c85f74c9c8c2e191386fa5b0f303080808080a0424abfab489aae23478cdb77d94884f081016ff9d0f19e5323be5b48ab93fba38080a0822cac0ead8bc0b754f7b1870f173d82bff5927133b0b7d8ff7e205d19fcbc2aa0ab1a33efeb6e8429ebcd98abc372ee0cb9995697f225da0ef6821f956eec6b968080","0xf8429f20e0f749549f867317422ea4090358c6bd20c9c8990b900e176bbc2ebb9cafa1a0f849b414d30876070fa6c341abc918c39a76f69de5422695b92e50710ce2aa2c"],"value":"112303809160144616231331421733204809404426618259802767219241643237959295740460"},"l2_ibc_account_proof":{"proof":["0xf90211a0cbbc6365c3259952ebe7a2b19d2cc328db3e4497aa219466fbf48e25c82cad35a0301d10da5257c53c2b3725a41de2c0ae68a7aba488bfdba8cf19b879d3a133c1a039737835575a621144fceceead026dc4d7f282bfaccc9003183779c59fb89792a0cda89a1886a65fc1145d6ec1f53a6e89bbe5fac14b4056eaabb2d188bd103721a02322b8140abfff8d8f3b0eca34de0e10869f1a354f3c6edba2d99c07bc6dcc10a00aa2e014f035006c09c56f4aa02caccfbab1c38406d7d817224a8ea8b044ae1ea0021df9a4351e21a0ad7d69ca86a698bc2f6266cd8d763f67d0484ac22ed1c845a087c442a4aebd380fd12b06b041054e841bc1f38554d2e8e4da33540d80a7114ba00bf92a8f32545e3ac334d02accff5de048c148f886bec549fc651dc8e37c7583a08ad6a7449b31ca0b250a6160f88469c1f5abeafaa9f4af2e7da016a660c1f66fa069d924e97c2b68b5a34dd485a0f3780fd675410694d22699b85ef4092c8cd738a0d592d7980c25e4177549f3ee7d83d6bc3d45cb887011120973bbbe46b1925610a0391fbe58b4eece2ec8741b8e163035f7aa81696ff9296c513c4898bfd90f18ffa0feba7153bd2bf48d77a1455fbf0a6caba25acb0f002f26d5cd93c6da75cf0461a026b88f37cae95480736d54dc6bba44202d7b20b13e01b36ae9e22a86155d17dfa0b0be8d8247248eb15a219ca02a55de1be444ac6f9e9896ac672bf478ca9f66ed80","0xf90211a0f4a70e0b9825050faca828d18fedf2a81ea738b5e85d4e92f8d8f14f3cb250b5a0a466007d4c13caae96d1286c6a8df7953bc78c32b3a0743970854c9cde88fac8a02550a172dc75c686b1d2582dba0c180f42830f76aa88ea8238ab7cb27e5b6068a06ca04f9eee1f3cf81d783eeeaed2d1e48509a26be1e002bd7e8995bce9aa587aa04ca59c3b982051523cba415dacd9fe47e8a863c8facd929d0f689d4a2c1be7aea0b192c0ab431d352c05b41579a875c2818e0f7d86a6246df3ea64b19ad0eeb2aca0f4e973e9e12f651814a13f6f04d46e7fc5dd01ee8c38f680416624b47928fb57a0210cabb0d2c46ce2baa2ae7fa85bf2da5e19d711fdc5e8f59b9a57154b6128f0a0582696919362619cb56f97dcea5e657bbd20d735b23cb862de94af09c73de4e2a0ff610451d8a8c66e6ec321169b674b421afed93004b75a11913c6c0ddc866e10a0a5629693ff0a368cfd8884bfa3d81d5737e3293a2acda86c5c101f8c758b5c63a0246600afb55252ec2f8cbda5afc6468c1830727e45aa1a9ea11034dbbd74f442a0d64bf6df75cc641a19dbcbcb29ef96a239e6bef426c1e0a59f592138d0e68737a084e9b0d74146a07de7b64ba874f73b58b6f34112a280404fc5ca33fd09ff3c6aa0c03bbee301abcb3403b68bdeecb199936f1bb0bb557e0a05bdee1d85a4435877a0c8199e4436ee73d9649b3f1fab2a3d941cea92c928ef181e23c86a9c611fb14980","0xf8d1a09d0b8f26e5709b0199c227afbd74a3f961d9c3e1b8de9128b060d6f87f36b92080808080a08a5c74905b21551ab81ff4ab60ffccbc77c3f63ca27a7ad89554fcedc6fb7f1d808080a01d389fcfd29047e74d1722e9ecf9a7d799376af387da16cf827a44881dddff11a020a76e5989b853053cea316c04e9454d42762a8cd99be791f7795543f3ba195aa01257f98eeedb62783792afcd6f9b8498dbcf07a488c3862a6a756274e1240857a087ae7ac62174d46489c903cbbe1914fcf076e7c92d45ab33f438023b98e1756880808080","0xf8689f3411163a2f29c7a6becfdb946a45129ed5cbb7be9ff8e64ce7aed2ce32af20b846f8440180a06e1d668f9bc508331e4d6804f230107fd360a50e9ec44dd26aeac30da7b85d9da0795c57e26220fed91dd5e491403ac8c689238eeb3ac1f841e1d9cc3222df5f9b"],"storage_root":"0x6e1d668f9bc508331e4d6804f230107fd360a50e9ec44dd26aeac30da7b85d9d"},"l1_next_node_num_slot_proof":{"key":"117","proof":["0xf90211a0378976b79a40d72a7aa1c422c02e67df614714be62363422a001007363aa34c1a0505128b8a90c1ae06d7b4e79d181bb1586be683d56f0eb5eb2f38eafe166afe1a0b784abc4936bcb27d8355b8311ae7644ba506a59c2f7061b7d52fc4c434c0517a075b64f474b83dd0f55e5e16fff6512f7f85e5ec1a1e5cbe9148581ba4ec598eda08d6b503164a45e76138d40a7d7e56ff91549ad38530f3b6ac7d4f2ee943957eca078821092621d2e3f7f621e8d15c9da570f234fe0e644ff296a08c1884b312f9ea09cbe765dfc6f7e184d967b0e03ba578282b528d6ffdef601164940234ddea18fa0cef0ff64344b715000c483f788016438774e6cc8484cdb18cc361e7b245dc123a0fdfa1e446df19af67f691121361499597993c65e69370661d03ef922a3f78910a0cc5b4e0cdcd2429154aa6a8c08d01c93cad7413044f21df107322be09f365abfa0af8ab900a5b8352836adfd6d0c7f30cf9b018ea2ba730312beb4023bf73666c3a040d0f37dff843b1660c606e8f03b1201a25ed7b0fbd3098c9a1eea576fc21ae4a087922516d5a213262c42af3c84caf92f9acd9d65e442e318c4e8fb2e1566cc86a0f89b382075a2be2fa560e9b63ea24c8bfb3ffa5fa94b4ffaec55be27efca1ca0a083315309a8356f86aee6a56e8b92d728d099abe32fe091d9b7d0dbd2b5d2bc1aa017f94590b4244ded96f036bdbb8e0922301bf3b3bfb561d4bff8cd5410e824cb80","0xf90211a0893ab29a493fb3ae9c72faa04431fe2a0d54df7b9289f3a2daf89e0b963a54f3a07a7d2d1847a8bf7c72731339bb0db95a99a6df630029eb1183d8906a1f760404a0df68e1ac3e12be190a1daae7ee09a3a84bc50feb1fdccb8bda527d79028301a7a0def5df6fbb25876484e5524c01b60d437e5b42451144d958453e0e167ed5b8a6a0ff9ac185786d6b40be5a3c7c897bb7eeaea840a3c02cc64e72b88651fa9eb917a040abaf7745dfc085faab43e8f64b5c0c84514ae44f7ed1a20ffc7788790cec4fa0eaa9e2f6051c5e1e4b50fa2345fc194543c387eaded215a120bfdeabb46c4560a07d6da2cae3a621a63b1aea8a8794f76ec3540636afb363fa874897cd2a9b4c94a0d0b2a668eee1f239a5a899ca8beebfa025e0dc30a216f2e33400ed695087a38ca042eaae8cf8e48b512e75cf0da31c5e182b50b99857464df474083e3409e1bdcaa0bc88c7c8682ec9e37c702030e3b9cd0c46c81d6eaeccf2e162151b27ad0881c8a04fcb74279d010acd29758524b5ca4171941843f4eefbdf7344626da7a85cb319a046657bb1d5fa61887bf4f5821106159c0bd4d5750cd57a4cb26fa1ee9851d5d3a0ceadb8b02842afd587a0c25a9eb5bd5e70e6b534363b22876ebdf9ce5d6e1294a04614e2bcbe7f3e81a1555fd467743bfa6b56490fc044e51988cdfcd5e5e48c26a04248138030e658d995e03f8e761bf0b9c4f696802cf10ab4cf748603acfa3c5c80","0xf90211a08480ca3f5828a50e914c3f5650ed135119770dd96608b180e6c01e1da5edda7da0ba9c688ed9993281213cedf64c40e9c5b44f84ec3a8efe4fc11805bf72b4b48ca03b301a0f54e524a0bde516ed59d2a7791632241deb932510b451c80e0a530bb1a0c4ba868a4e4e77419f7736bb6fa3bb08882bbea542a1355027e15046208febd4a09cc42a47ed2098b0d3c3d60d55a96929fa3a45d87ce7db2c6256da885883094ea044cb87e48720052c39e571ba49c215218e992a055367995e697bcc8cd198357ca0a3335f957a729c784c1c3e0d0441de297e1646e8327130f6b8f4faebda8d6661a07a1a15c9042a77c60343260527abb0b505dd22a75a297aaf4592a5c9212dd9b5a0512f96fe94dc1002d00544587d9e7f9350bddf82e2e04e2efc93962b6a5098c0a0afa1a682914c10ff3bd3e2be1bdbbe7abd1101b4c578f6cea17d11082ab47d96a040f7f4746637c037c11951950fbe78c9a5940d5d7c3fdb8a9e763098406c8306a0f8611d790b4dba7fae14fdee5dfd4b796341ffcf45e19ec0b954a231951338eca097acef1716dbac0cc06a114228acb06a34c564bf68b3d64bed408a57d1a512f4a0c7bcdd8021cb5e20abad7756478a2d4165ab8d848896e12ba65fefd8cb57289ca053ef83a57d7075888aa3bc2243e0e98d300c7eb79c912f003c87e9148ac99832a03ef7bf22576fa01b5a235342aeed4af839db4d4b398ef348700ba1a23ad8083e80","0xf8918080808080808080a031421d0233b71852aeeda8801c6ee14507d15ad6834edaad66d22bc328e6f96e8080a0e324715d1594b0a612614d95023ecc35f5eeb103ee858ffe6a58821ee6b2a243a0c335c3fa1dfd41ab91d6a3b40cd8bde670b81b277c456e2314507c495cda0faba063db626a21d6e87d5fdc8dd9b29f2157db7c32848b8207826dd7fb1a2aae40b1808080","0xf83d9f2093986a7b9e6294572ea6736696119c195c1a9f5eae642d3c5fcd44e49dea9c9b6b64d90000000000000c100000000000000c110000000000000c10"],"value":"44179302843844739564926425000897130190127930798988182312636648464"}}"#).unwrap();

        let ClientState::V1(client_state) = serde_json::from_str::<ClientState>(r#"{"v1":{"chain_id":"21000001","latest_height":175633,"l1_client_id":8,"l1_contract_address":"0xd318638594a5b17b50a1389b0c0580576226c0ae","frozen_height":"0","ibc_contract_address":"0x06a409cbed33caa9bf8181ef3aff2c504e1cfb95"}}"#).unwrap();

        verify_header_v1(
            &client_state,
            &header,
            hex!("8fac75a71de3961ea66fe8de326346d4d8b4ec98a769639a65c61dc539b80d8b").into(),
        )
        .unwrap();
    }
}
